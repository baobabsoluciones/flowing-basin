"""
Parse the results from RL Zoo's hyperparameter tuning
"""

import os


def get_reports(log_dir: str) -> list[tuple[str, str, str]]:
    """
    Get all the report files generated by RL Zoo (.pkl)
    in the given logs directory
    :param log_dir:
    :return: List with (algorithm, env_id, report_path) tuples
    """
    reports = []
    for root, dirs, files in os.walk(log_dir):
        if len(root.split("\\")) == 2:
            # Example: "logs\sac"
            algorithm = root.split("\\")[1]
            for file in files:
                if file.startswith("report_") and file.endswith(".pkl"):
                    # Example: "report_RLEnvironment-A1G0O231R1T0_100-trials-49500-tpe-median_1713179196.pkl"
                    names = file.split("_")
                    env_id = names[1].split("-")[1]
                    trials = names[2].split("-")[0]
                    if int(trials) >= 100:
                        reports.append((algorithm, env_id, os.path.join(root, file)))
    return reports


if __name__ == "__main__":

    FOLDER = "best_hyperparams"

    for algo, env, path in get_reports("logs"):
        filename = f"hyperparams_{algo}_{env}"
        os.system(
            f"python parse_study.py -i {path} "
            f"--print-n-best-trials 1 --save-n-best-hyperparameters 1 -f {FOLDER} -fn {filename}"
        )
        print(f"Created file {FOLDER}/{filename}_1.json")
